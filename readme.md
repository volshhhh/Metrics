# Система сбора и логирования метрик

## Описание

Проект реализует многопоточную систему сбора, агрегации и логирования различных метрик для приложений на C++. Система поддерживает пользовательские метрики, определение подозрительных (роботизированных) пользователей по частоте кликов, а также простое расширение новыми типами метрик.
---

## Основные компоненты

### 1. Интерфейс метрики (`IMetric`)
Базовый интерфейс для всех метрик:
- `getName()` — возвращает имя метрики.
- `getValueAndReset()` — возвращает значение и сбрасывает состояние.

### 2. Реализации метрик
- **CounterMetric** — считает количество событий (например, запросов).
- **AverageMetric** — считает среднее значение по поступившим сэмплам (например, задержка).
- **UserClickCountMetric** — считает общее количество кликов пользователей.
- **RobotDetectionMetric** — определяет количество "роботов" (пользователей, совершивших слишком много кликов за короткое время).

### 3. ClickTracker
Класс для отслеживания кликов пользователей и определения "роботов" по заданным порогам.

### 4. MetricsWriter
Потокобезопасный логгер, который периодически опрашивает все зарегистрированные метрики и пишет их значения в файл `metrics.log`.

---

## Как работает main.cpp

- Создаются и регистрируются метрики.
- Запускаются три потока:
  - Первый увеличивает счётчик запросов с разной задержкой.
  - Второй добавляет случайные значения задержки.
  - Третий симулирует клики обычных пользователей и "роботов".
- Логгер каждую секунду записывает значения всех метрик в файл.
- Программа работает 10 секунд, после чего завершает все потоки.

---

## Пример вывода (metrics.log)

```
2025-06-15 12:00:01.123 "requests" 7 "latency_ms" 245.67 "TotalUserClicks" 34 "RobotCount" 0
2025-06-15 12:00:02.124 "requests" 10 "latency_ms" 198.12 "TotalUserClicks" 41 "RobotCount" 1
...
```

---

## Как собрать и запустить

1. **Сборка:**
   ```sh
   cmake -S . -B build
   cmake --build build
   ```

2. **Запуск:**
   ```sh
   ./build/my_app
   ```

3. **Результат:**  
   Метрики будут записываться в файл `metrics.log` в корне проекта.
